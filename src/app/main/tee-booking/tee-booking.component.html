<section class="page-title d-flex justify-content-center align-items-center">
  <div class="bg-layer" [style.background-image]="'url(' + course.imageUrl + ')'"></div>
  <div class="container">
    <div class="row">
      <div class="col-12">
        <h1>{{course.name}}</h1>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <fa-icon [icon]="locationIcon"></fa-icon>
              {{course.lane}}, {{course.address}}
            </li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
</section>

<!-- Main Content Section -->
<section class="course-section">
  <div class="container">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-lg-4 col-md-12 order-lg-1 order-2">
        <!-- Booking Form Widget -->
        <div class="sidebar-widget">
          <div class="widget-title">
            <h3>Book Your Tee Time</h3>
          </div>

          <div class="booking-form">
            <!-- Step 1: Tee Selection -->
            <div class="form-section">
              <div class="label-with-icon">
                <div class="label-group">
                  <fa-icon [icon]="golfIcon" class="section-icon"></fa-icon>
                  <label>Select Tee</label>
                </div>
              </div>
              
              <div class="tee-options">
                <button class="tee-option" 
                        *ngFor="let tee of availableTees"
                        [class.selected]="selectedTee?.id === tee.id"
                        (click)="selectTee(tee)">
                  <span class="tee-name">{{tee.label || (tee.holeNumber + ' Holes')}}</span>
                </button>
                
                <!-- Show message when no tees available -->
                <div *ngIf="availableTees.length === 0 && !isLoading" class="no-tees-message">
                  <p>No tees available for this course.</p>
                  <button class="theme-btn" (click)="loadAvailableTees()">Retry Loading Tees</button>
                </div>
                
                <!-- Show loading state -->
                <div *ngIf="isLoading" class="loading-message">
                  <p>Loading available tees...</p>
                </div>
              </div>
              

            </div>

            <!-- Step 2: Date Selection (only visible after tee selected) -->
            <div class="form-section" *ngIf="selectedTee">
              <div class="label-with-icon">
                <div class="label-group">
                  <fa-icon [icon]="calendarIcon" class="section-icon"></fa-icon>
                  <label>Select Date</label>
                </div>
              </div>

              <!-- Current Date Display -->
              <div class="current-date-display" (click)="toggleCalendar()">
                <div class="date-info">
                  <span class="date-value">{{selectedDate | date:'MMM d, yyyy'}}</span>
                  <span class="date-day">{{selectedDate | date:'EEEE'}}</span>
                </div>
                <div class="calendar-toggle-icon">
                  <fa-icon [icon]="showCalendar ? chevronUpIcon : chevronDownIcon"></fa-icon>
                </div>
              </div>

              <!-- Calendar View (Collapsible) -->
              <div class="calendar-view" [class.show]="showCalendar">
                <div class="calendar-header">
                  <button class="month-nav" (click)="previousMonth()">
                    <fa-icon [icon]="chevronLeftIcon"></fa-icon>
                  </button>
                  <span class="current-month">{{currentDate | date:'MMMM yyyy'}}</span>
                  <button class="month-nav" (click)="nextMonth()">
                    <fa-icon [icon]="chevronRightIcon"></fa-icon>
                  </button>
                </div>
                <div class="calendar-weekdays">
                  <span *ngFor="let day of weekDays">{{day}}</span>
                </div>
                <div class="calendar-days">
                  <button *ngFor="let day of calendarDays"
                          class="calendar-day"
                          [class.selected]="isDateSelected(day.date)"
                          [class.today]="isToday(day.date)"
                          [class.available]="day.available"
                          [class.other-month]="day.otherMonth"
                          [disabled]="!day.available || day.otherMonth"
                          (click)="selectDate(day.date)">
                    <div class="day-number">{{day.date | date:'d'}}</div>
                  </button>
                </div>
              </div>
            </div>

            <!-- Step 3: Time Selection (only visible after date selected) -->
            <div class="form-section" *ngIf="selectedDate && selectedTee">
              <div class="label-with-icon">
                <div class="label-group">
                  <fa-icon [icon]="clockIcon" class="section-icon"></fa-icon>
                  <label>Available Times</label>
                </div>                
              </div>

              <!-- Color Legend for Time Slots -->
              <div class="time-slot-legend" *ngIf="currentTimeSlots.length > 0">
                <div class="legend-items">
                  <div class="legend-item">
                    <div class="legend-color available-color"></div>
                    <span class="legend-text">Available</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color partial-color"></div>
                    <span class="legend-text">Partially Available</span>
                  </div>
                  <div class="legend-item">
                    <div class="legend-color selected-color"></div>
                    <span class="legend-text">Selected</span>
                  </div>
                </div>
              </div>
              
              <div class="time-slots-container">
                <div class="time-slots-grid">
                                                        <button *ngFor="let slot of currentTimeSlots"
                            class="time-slot"
                            [class]="getSlotClass(slot)"
                            [disabled]="slot.slot_status === 'booked' || !slot.available"
                            (click)="toggleSlotSelection(slot)"
                            (contextmenu)="deselectSlotDirect(slot); $event.preventDefault()"
                            [title]="getSlotTooltip(slot) + (slot.isSelected ? ' (Right-click to deselect)' : '')"
                            [attr.data-debug]="'isSelected:' + slot.isSelected + ', class:' + getSlotClass(slot)">
                    <div class="time-slot-content">
                      <span class="time">{{slot.time}}</span>
                      <div class="golf-ball" [class.available]="slot.slot_status === 'available'">
                        <div class="dimples">
                          <div class="dimple"></div>
                          <div class="dimple"></div>
                          <div class="dimple"></div>
                        </div>
                      </div>
                    </div>
                  </button>
                </div>
                
                <!-- Show message when no time slots are available -->
                <div *ngIf="currentTimeSlots.length === 0 && !isLoading" class="no-slots-message">
                  <p>No available time slots for the selected date.</p>
                </div>
              </div>
            </div>

            <!-- Booking Summary (only visible when slots are selected) -->
            <div class="booking-summary" *ngIf="canBook()">
              <div class="summary-header">
                <h4>Booking Summary</h4>
              </div>
              
              <!-- Multi-Slot Booking Summary -->
              <div class="summary-details" *ngIf="selectedSlots.length > 0">
                <div class="summary-item">
                  <span class="label">Total Slots:</span>
                  <span class="value">{{selectedSlots.length}} slot{{selectedSlots.length > 1 ? 's' : ''}}</span>
                </div>
                <div class="summary-actions">
                  <button class="clear-all-btn" (click)="clearAllSelections()" title="Clear all selected slots">
                    Clear All
                  </button>
                </div>
              </div>
              
              <!-- Detailed Slot Information - Grouped by Tee -->
              <div class="selected-slots-details" *ngIf="selectedSlots.length > 0">
                <div class="slots-details-header">
                  <h5>Slot Details</h5>
                </div>
                
                <!-- Group slots by tee -->
                <div *ngFor="let teeGroup of getSlotsGroupedByTee(); let teeIndex = index" class="tee-group">
                  <div class="tee-group-header">
                    <h6>{{teeGroup.teeLabel}}</h6>
                    <span class="tee-slot-count">{{teeGroup.slots.length}} slot{{teeGroup.slots.length > 1 ? 's' : ''}}</span>
                  </div>
                  
                  <!-- Slots for this tee -->
                  <div class="slot-detail-item" *ngFor="let slot of teeGroup.slots; let i = index" 
                       (click)="openSlotModal(slot)" 
                       style="cursor: pointer;">
                    <div class="slot-detail-header">
                      <span class="slot-number">Slot {{i + 1}}</span>
                      <button class="clear-slot-btn" (click)="deselectSlotFromSummary(slot); $event.stopPropagation()" title="Remove this slot">
                        ×
                      </button>
                    </div>
                    <div class="slot-detail-content">
                      <div class="slot-detail-row">
                        <span class="label">Date:</span>
                        <span class="value">{{slot.date | date:'EEEE, MMMM d, yyyy'}}</span>
                      </div>
                      <div class="slot-detail-row">
                        <span class="label">Time:</span>
                        <span class="value">{{slot.time}}</span>
                      </div>
                      <div class="slot-detail-row">
                        <span class="label">Participants:</span>
                        <span class="value">{{slot.participants}} player{{slot.participants > 1 ? 's' : ''}}</span>
                      </div>
                      <!-- Show status for partially available slots -->
                      <div class="slot-detail-row" *ngIf="slot.slot_status === 'partially_available'">
                        <span class="label">Slot Type:</span>
                        <span class="value" [class.status-pending]="!slot.isOwnBooking" [class.status-owner]="slot.isOwnBooking">
                          <span *ngIf="slot.isOwnBooking">👑 Owner Booking</span>
                          <span *ngIf="!slot.isOwnBooking">⚠️ Join Request</span>
                        </span>
                      </div>
                      <!-- Show additional info for join requests or owner bookings -->
                      <div class="slot-detail-row" *ngIf="slot.slot_status === 'partially_available' && slot.total_participants">
                        <span class="label">Slot Info:</span>
                        <span class="value">{{slot.total_participants}}/4 participants ({{slot.available_spots || 4}} spots left)</span>
                      </div>
                      <!-- Show note for join requests or owner bookings -->
                      <div class="slot-join-note" *ngIf="slot.slot_status === 'partially_available'">
                        <div class="note-content">
                          <strong>Note:</strong> 
                          <span *ngIf="slot.isOwnBooking">
                            This is your booking with {{slot.total_participants}} participant(s). You can add more participants to this slot.
                          </span>
                          <span *ngIf="!slot.isOwnBooking">
                            This slot already has {{slot.total_participants}} participant(s). 
                            If you select this slot, it will create a join request that needs approval from the original booker.
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <button class="theme-btn w-100"
                    [disabled]="!canBook()"
                    [class.loading]="isLoading"
                    (click)="bookTeeTime()">
              {{isLoading ? 'Booking...' : 
                (selectedSlots.length > 0 ? 
                  ('Book ' + selectedSlots.length + ' Slot' + (selectedSlots.length > 1 ? 's' : '')) : 
                  'Book Now'
                )
              }}
            </button>
            
            <!-- Login prompt for unauthenticated users -->
            <div class="login-prompt" *ngIf="!isAuthenticated()">
              <p><small>Please log in to book a tee time</small></p>
            </div>



            <div class="error-message" *ngIf="errorMessage">
              {{errorMessage}}
            </div>
          </div>
        </div>
        
        <!-- Optimized Contact & Directions Widget -->
        <div class="contact-directions-widget">
          <div class="widget-header">
            <h3><fa-icon [icon]="locationIcon"></fa-icon> Contact & Directions</h3>
          </div>
          
          <div class="contact-info">
            <div class="info-item" (click)="copyToClipboard(course.address)">
              <div class="icon-wrapper">
                <fa-icon [icon]="locationIcon"></fa-icon>
              </div>
              <div class="info-content">
                <span class="label">Location</span>
                <span class="value">{{course.address}}</span>
              </div>
              <div class="action-icon">
                <fa-icon [icon]="copyIcon" title="Copy address"></fa-icon>
              </div>
            </div>

            <div class="info-item" (click)="makeCall()">
              <div class="icon-wrapper">
                <fa-icon [icon]="phoneIcon"></fa-icon>
              </div>
              <div class="info-content">
                <span class="label">Phone</span>
                <span class="value">{{course.phone}}</span>
              </div>
              <div class="action-icon">
                <fa-icon [icon]="phoneIcon" title="Call now"></fa-icon>
              </div>
            </div>
          </div>

          <div class="direction-actions">
            <button class="action-btn primary" (click)="getDirections()">
              <fa-icon [icon]="directionsIcon"></fa-icon>
              <span>Get Directions</span>
            </button>
            <button class="action-btn secondary" (click)="shareLocation()">
              <fa-icon [icon]="shareIcon"></fa-icon>
              <span>Share Location</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="col-lg-8 col-md-12 order-lg-2 order-1">
        <div class="main-content">
          <!-- Course Image -->
          <img [src]="course.imageUrl"
               alt="{{course.name}}"
               class="hero-image">

          <!-- Course Information -->
          <div class="content-section">
            <h2>About {{course.name}}</h2>
            <p *ngIf="course.description">{{course.description}}</p>
            <p *ngIf="!course.description">Experience exceptional golfing conditions with our meticulously maintained fairways, challenging layout, and stunning natural surroundings. Perfect for golfers of all skill levels.</p>

            <h3>Our facilities include</h3>
            <div class="amenities-grid" *ngIf="course.amenities && course.amenities.length > 0">
              <div class="amenity-item" *ngFor="let amenity of course.amenities; trackBy: trackByAmenity">
                <div class="amenity-icon-wrapper">
                  <div class="amenity-icon" *ngIf="getSafeSvgIcon(amenity)" [innerHTML]="getSafeSvgIcon(amenity)"></div>
                  <fa-icon *ngIf="!getSafeSvgIcon(amenity)" [icon]="getAmenityIcon(amenity)"></fa-icon>
                </div>
                <div class="amenity-content">
                  <h4 class="amenity-name">{{amenity.amenityName}}</h4>
                  <p class="amenity-description">{{amenity.amenitiesDescription || amenity.amenityTooltip}}</p>
                </div>
              </div>
            </div>
            
            <!-- Fallback facilities if no amenities are available -->
            <div class="amenities-grid" *ngIf="!course.amenities || course.amenities.length === 0">
              <div class="amenity-item">
                <div class="amenity-icon-wrapper">
                  <fa-icon [icon]="wifiIcon"></fa-icon>
                </div>
                <div class="amenity-content">
                  <h4 class="amenity-name">Free WiFi</h4>
                  <p class="amenity-description">Stay connected throughout your visit with complimentary high-speed internet access.</p>
                </div>
              </div>
              <div class="amenity-item">
                <div class="amenity-icon-wrapper">
                  <fa-icon [icon]="parkingIcon"></fa-icon>
                </div>
                <div class="amenity-content">
                  <h4 class="amenity-name">Free Parking</h4>
                  <p class="amenity-description">Convenient and secure parking facilities available for all guests.</p>
                </div>
              </div>
              <div class="amenity-item">
                <div class="amenity-icon-wrapper">
                  <fa-icon [icon]="restaurantIcon"></fa-icon>
                </div>
                <div class="amenity-content">
                  <h4 class="amenity-name">Restaurant</h4>
                  <p class="amenity-description">Enjoy delicious meals and refreshments at our on-site restaurant.</p>
                </div>
              </div>
              <div class="amenity-item">
                <div class="amenity-icon-wrapper">
                  <fa-icon [icon]="shopIcon"></fa-icon>
                </div>
                <div class="amenity-content">
                  <h4 class="amenity-name">Pro Shop</h4>
                  <p class="amenity-description">Browse our fully-stocked pro shop for all your golfing needs.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Slot Selection Modal (Integrated into booking flow) -->
<div class="slot-modal-overlay" *ngIf="showSlotModal && currentSlotForModal" (click)="closeSlotModal()">
  <div class="slot-modal-content" (click)="$event.stopPropagation()">
    <div class="slot-modal-header">
      <h3 class="slot-modal-title">Slot Details</h3>
      <button class="slot-modal-close" (click)="closeSlotModal()">
        ×
      </button>
    </div>
    
    <div class="slot-modal-body" *ngIf="currentSlotForModal">
      <!-- Loading state -->
      <div *ngIf="!currentSlotForModal.formatted_time && !currentSlotForModal.time" class="loading-message">
        <p>Loading slot details...</p>
      </div>
      
      <!-- Slot content when data is available -->
      <div *ngIf="currentSlotForModal.formatted_time || currentSlotForModal.time">
        <!-- Participant Selector in Modal -->
        <div class="slot-modal-section">
          <div class="slot-modal-section-title">
            <div class="slot-modal-section-icon">
              <fa-icon [icon]="usersIcon"></fa-icon>
            </div>
            Add Participants
          </div>
          <div class="player-selector modal-player-selector">
            <button class="circle-btn" (click)="decrementModalParticipants()" [disabled]="currentSlotParticipants === 1">-</button>
            <span class="player-count">{{currentSlotParticipants}}</span>
            <button class="circle-btn" (click)="incrementModalParticipants()" [disabled]="currentSlotParticipants >= (currentSlotForModal.available_spots || 4)">+</button>
          </div>
                    <div class="slot-info-text small-text">
            (Max: {{getMaxModalParticipants()}} participants)
          </div>
        </div>

        <!-- Slot Information Row -->
        <div class="slot-modal-section">
          <div class="slot-modal-section-title">
            <div class="slot-modal-section-icon">
              <fa-icon [icon]="golfIcon"></fa-icon>
            </div>
            Slot Information
          </div>
          <div class="slot-info-row">
            <div class="slot-info-item">
              <span class="slot-info-label">Course:</span>
              <span class="slot-info-value course-name">{{course.name}}</span>
            </div>
            <div class="slot-info-item">
              <span class="slot-info-label">Tee:</span>
              <span class="slot-info-value tee-name">{{currentSlotForModal.tee_name || selectedTee?.label || (selectedTee?.holeNumber + ' Holes')}}</span>
            </div>
            <div class="slot-info-item">
              <span class="slot-info-label">Date:</span>
              <span class="slot-info-value slot-date">
                {{currentSlotForModal.slot_date ? (currentSlotForModal.slot_date | date:'EEEE, MMMM d, yyyy') : (selectedDate | date:'EEEE, MMMM d, yyyy')}}
              </span>
            </div>
            <div class="slot-info-item">
              <span class="slot-info-label">Time:</span>
              <span class="slot-info-value slot-time">{{currentSlotForModal?.formatted_time || currentSlotForModal?.time || 'N/A'}}</span>
            </div>
            <div class="slot-info-item">
              <span class="slot-info-label">Status:</span>
              <span class="slot-info-value slot-status" 
                    [class.status-selected]="currentSlotForModal?.slot_status === 'selected'"
                    [class.status-available]="currentSlotForModal?.slot_status === 'available'"
                    [class.status-partial]="currentSlotForModal?.slot_status === 'partially_available'"
                    [class.status-booked]="currentSlotForModal?.slot_status === 'booked'">
                {{ 
                  currentSlotForModal?.slot_status === 'selected' ? 'Selected' :
                  (currentSlotForModal?.slot_status === 'available' ? 'Available' : 
                  (currentSlotForModal?.slot_status === 'partially_available' ? 'Partially Available' : 
                  (currentSlotForModal?.slot_status || (currentSlotForModal?.available ? 'Available' : 'Booked')))) 
                }}
              </span>
            </div>
            <div class="slot-info-item">
              <span class="slot-info-label">Available Spots:</span>
              <span class="slot-info-value available-spots">{{currentSlotForModal?.available_spots || 4}}</span>
            </div>
            <div class="slot-info-item">
              <span class="slot-info-label">Current Participants:</span>
              <span class="slot-info-value current-participants">
                {{currentSlotForModal?.slot_status === 'partially_available' ? 
                  (currentSlotForModal.total_participants || 0) : 0}}/4
              </span>
            </div>
            <!-- Show additional info for partially available slots -->
            <div class="slot-info-item" *ngIf="currentSlotForModal?.slot_status === 'partially_available'">
              <span class="slot-info-label">Slot Type:</span>
              <span class="slot-info-value" [class.slot-type-warning]="!currentSlotForModal?.isOwnBooking" [class.slot-type-owner]="currentSlotForModal?.isOwnBooking">
                <span *ngIf="currentSlotForModal?.isOwnBooking">👑 Owner Booking</span>
                <span *ngIf="!currentSlotForModal?.isOwnBooking">⚠️ Join Request</span>
              </span>
            </div>
            <!-- Show note for partially available slots -->
            <div class="slot-info-note" *ngIf="currentSlotForModal?.slot_status === 'partially_available'">
              <div class="note-content">
                <strong>Note:</strong> 
                <span *ngIf="currentSlotForModal?.isOwnBooking">
                  This is your booking with {{currentSlotForModal.total_participants}} participant(s). You can add more participants to this slot.
                </span>
                <span *ngIf="!currentSlotForModal?.isOwnBooking">
                  This slot already has {{currentSlotForModal.total_participants}} participant(s). 
                  If you select this slot, it will create a join request that needs approval from the original booker.
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>



      <!-- Action Buttons -->
      <div class="slot-modal-actions">
        <button class="slot-modal-btn secondary" (click)="closeSlotModal()">
          Cancel
        </button>
        <button class="slot-modal-btn primary" 
                (click)="confirmSlotSelection()"
                [disabled]="currentSlotParticipants > (currentSlotForModal.available_spots || 4)">
          Select Slot
        </button>
      </div>
      </div>
    </div>
</div>

<!-- Booking Confirmation Modal -->
<div class="modal-overlay" *ngIf="showBookingModal" (click)="closeBookingModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Booking Confirmation</h3>
      <button class="modal-close" (click)="closeBookingModal()">
        <fa-icon [icon]="chevronUpIcon"></fa-icon>
      </button>
    </div>
    
    <div class="modal-body" *ngIf="bookingConfirmationData">
      <div class="confirmation-icon">
        <fa-icon [icon]="golfIcon"></fa-icon>
      </div>
      
      <div class="confirmation-message">
        <!-- Enhanced confirmation messages -->
        <h4 *ngIf="bookingConfirmationData.confirmationTitle">
          {{bookingConfirmationData.confirmationTitle}}
        </h4>
        <p *ngIf="bookingConfirmationData.confirmationSubtitle" class="total-bookings">
          {{bookingConfirmationData.confirmationSubtitle}}
        </p>
        
        <!-- Fallback messages for backward compatibility -->
        <h4 *ngIf="!bookingConfirmationData.confirmationTitle && bookingConfirmationData.confirmedCount > 0 && bookingConfirmationData.pendingCount === 0">
          Your tee time has been booked successfully!
        </h4>
        <h4 *ngIf="!bookingConfirmationData.confirmationTitle && bookingConfirmationData.pendingCount > 0 && bookingConfirmationData.confirmedCount === 0">
          Your tee time has been Requested!
        </h4>
        <h4 *ngIf="!bookingConfirmationData.confirmationTitle && bookingConfirmationData.confirmedCount > 0 && bookingConfirmationData.pendingCount > 0">
          Your tee time has been partially booked!
        </h4>
        <h4 *ngIf="!bookingConfirmationData.confirmationTitle && bookingConfirmationData.confirmedCount === 0 && bookingConfirmationData.pendingCount === 0">
          Your tee time has been processed!
        </h4>
        
        <p *ngIf="!bookingConfirmationData.confirmationSubtitle && bookingConfirmationData.confirmedCount > 0" class="total-bookings">
          {{bookingConfirmationData.confirmedCount}} individual booking{{bookingConfirmationData.confirmedCount > 1 ? 's' : ''}} created
        </p>
        <p *ngIf="!bookingConfirmationData.confirmationSubtitle && bookingConfirmationData.pendingCount > 0" class="total-bookings">
          {{bookingConfirmationData.pendingCount}} request{{bookingConfirmationData.pendingCount > 1 ? 's' : ''}} created
        </p>
        <p *ngIf="!bookingConfirmationData.confirmationSubtitle && addParticipantsCount > 0" class="total-bookings">
          {{addParticipantsCount}} participant{{addParticipantsCount > 1 ? 's' : ''}} added to existing slot{{addParticipantsCount > 1 ? 's' : ''}}
        </p>
      </div>
      
      <div class="booking-details">
        <div class="detail-item">
          <span class="label">Course:</span>
          <span class="value">{{bookingConfirmationData.courseName || course.name}}</span>
        </div>
        
        <!-- Enhanced slot details display -->
        <div class="detail-item" *ngIf="bookingConfirmationData.slotDetails && bookingConfirmationData.slotDetails.length > 0">
          <span class="label">Slots:</span>
          <div class="value slots-row-container">
            <div class="slot-row" *ngFor="let slot of bookingConfirmationData.slotDetails">
              <div class="slot-info">
                <div class="slot-main-details">
                  <span class="slot-booking-id"><strong>ID: {{slot.bookingId}}</strong></span>
                  <span class="slot-tee">{{slot.tee}}</span>
                  <span class="slot-time">{{slot.time}}</span>
                  <span class="slot-date">{{slot.date}}</span>
                  <span class="slot-participants">{{slot.participants}}p</span>
                  <span class="slot-status" 
                        [class.status-confirmed]="slot.status === 'confirmed'"
                        [class.status-pending]="slot.status === 'pending'"
                        [class.status-existing]="slot.status === 'existing_request'"
                        [class.status-completed]="slot.status === 'completed'">
                    {{slot.statusText}}
                  </span>
                </div>
                <div class="slot-additional-info" *ngIf="slot.isExistingRequest">
                  <small class="existing-request-info">
                    You already have a {{slot.existingStatus}} request for this slot.
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Fallback slot details for backward compatibility -->
        <div class="detail-item" *ngIf="!bookingConfirmationData.slotDetails && bookingConfirmationData.selectedSlots">
          <span class="label">Slots:</span>
          <div class="value slots-row-container">
            <div class="slot-row" *ngFor="let slot of bookingConfirmationData.selectedSlots; let i = index">
              <div class="slot-info">
                <div class="slot-main-details">
                  <span class="slot-booking-id" *ngIf="bookingConfirmationData.slotBookings && bookingConfirmationData.slotBookings[i]">
                    <strong>ID: {{bookingConfirmationData.slotBookings[i].booking_id}}</strong>
                  </span>
                  <span class="slot-booking-id" *ngIf="!bookingConfirmationData.slotBookings || !bookingConfirmationData.slotBookings[i]">
                    <strong>ID: N/A</strong>
                  </span>
                  <span class="slot-tee">{{slot.tee_name || slot.tee || 'Unknown Tee'}}</span>
                  <span class="slot-time">{{slot.time}}</span>
                  <span class="slot-date">{{slot.date ? (slot.date | date:'MMM d, yyyy') : 'N/A'}}</span>
                  <span class="slot-participants">{{slot.participants}}p</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- <div class="detail-item">
          <span class="label">Status:</span>
          <span class="value" 
                [class.status-confirmed]="bookingConfirmationData.status === 'Completed'"
                [class.status-pending]="bookingConfirmationData.status === 'Mixed' || bookingConfirmationData.pendingCount > 0">
            {{bookingConfirmationData.status || 'Pending'}}
            <span *ngIf="bookingConfirmationData.pendingCount > 0" class="pending-count">
              ({{bookingConfirmationData.pendingCount}} pending)
            </span>
          </span>
        </div> -->
        
        <!-- Show additional info for join requests or owner bookings -->
        <div class="detail-item" *ngIf="!bookingConfirmationData.slotDetails && bookingConfirmationData.selectedSlots">
          <span class="label">Additional Info:</span>
          <div class="value slots-info-list">
            <div class="slot-info-item" *ngFor="let slot of bookingConfirmationData.selectedSlots; let i = index">
              <!-- Show additional info for join requests or owner bookings -->
              <div class="slot-join-info" *ngIf="slot.isJoinRequest || slot.isOwnBooking">
                <small class="join-request-note" *ngIf="slot.isJoinRequest">
                  ⚠️ This slot already has {{slot.originalSlotParticipants}} participant(s). 
                  Your request is pending approval from the original booker.
                </small>
                <small class="owner-booking-note" *ngIf="slot.isOwnBooking">
                  👑 This is your existing booking. You've added {{slot.participants}} more participant(s) to this slot.
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="confirmation-actions">
        <button class="theme-btn" (click)="closeBookingModal()">
          <fa-icon [icon]="golfIcon"></fa-icon>
          Continue Booking
        </button>
      </div>
    </div>
  </div>
</div>